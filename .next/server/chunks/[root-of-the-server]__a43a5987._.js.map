{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///D:/Documentos/Trae/autosheets/src/lib/security/config.ts"],"sourcesContent":["// Configurações de segurança baseadas no OWASP Top 10\r\nexport const SECURITY_CONFIG = {\r\n  // Rate limiting\r\n  RATE_LIMIT: {\r\n    windowMs: 15 * 60 * 1000, // 15 minutos\r\n    max: 100, // máximo 100 requests por IP\r\n  },\r\n  \r\n  // JWT Configuration\r\n  JWT: {\r\n    expiresIn: '24h',\r\n    algorithm: 'HS256' as const,\r\n  },\r\n  \r\n  // Password requirements\r\n  PASSWORD: {\r\n    minLength: 8,\r\n    requireUppercase: true,\r\n    requireLowercase: true,\r\n    requireNumbers: true,\r\n    requireSpecialChars: true,\r\n  },\r\n  \r\n  // CORS settings\r\n  CORS: {\r\n    origin: process.env.NODE_ENV === 'production' \r\n      ? ['https://yourdomain.com'] \r\n      : ['http://localhost:3000'],\r\n    credentials: true,\r\n  },\r\n  \r\n  // Security headers\r\n  HEADERS: {\r\n    'X-Frame-Options': 'DENY',\r\n    'X-Content-Type-Options': 'nosniff',\r\n    'Referrer-Policy': 'strict-origin-when-cross-origin',\r\n    'Permissions-Policy': 'camera=(), microphone=(), geolocation=()',\r\n  },\r\n};\r\n\r\nexport const TELEGRAM_CONFIG = {\r\n  MAX_MESSAGE_LENGTH: 4096,\r\n  ALLOWED_CHAT_TYPES: ['group', 'supergroup'],\r\n  RATE_LIMIT_PER_CHAT: 30, // mensagens por minuto\r\n};\r\n\r\nexport const SHEETS_CONFIG = {\r\n  MAX_ROWS_PER_BATCH: 1000,\r\n  RETRY_ATTEMPTS: 3,\r\n  TIMEOUT_MS: 30000,\r\n};"],"names":[],"mappings":"AAAA,sDAAsD;;;;;;AAC/C,MAAM,kBAAkB;IAC7B,gBAAgB;IAChB,YAAY;QACV,UAAU,KAAK,KAAK;QACpB,KAAK;IACP;IAEA,oBAAoB;IACpB,KAAK;QACH,WAAW;QACX,WAAW;IACb;IAEA,wBAAwB;IACxB,UAAU;QACR,WAAW;QACX,kBAAkB;QAClB,kBAAkB;QAClB,gBAAgB;QAChB,qBAAqB;IACvB;IAEA,gBAAgB;IAChB,MAAM;QACJ,QAAQ,sCACJ,0BACA;YAAC;SAAwB;QAC7B,aAAa;IACf;IAEA,mBAAmB;IACnB,SAAS;QACP,mBAAmB;QACnB,0BAA0B;QAC1B,mBAAmB;QACnB,sBAAsB;IACxB;AACF;AAEO,MAAM,kBAAkB;IAC7B,oBAAoB;IACpB,oBAAoB;QAAC;QAAS;KAAa;IAC3C,qBAAqB;AACvB;AAEO,MAAM,gBAAgB;IAC3B,oBAAoB;IACpB,gBAAgB;IAChB,YAAY;AACd","debugId":null}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///D:/Documentos/Trae/autosheets/src/lib/auth/service.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\nimport { SECURITY_CONFIG } from '../security/config';\r\n\r\ninterface User {\r\n  id: string;\r\n  email: string;\r\n  username: string;\r\n  password: string;\r\n  role: 'admin' | 'user';\r\n  telegramUserId?: number;\r\n  createdAt: Date;\r\n  lastLogin?: Date;\r\n}\r\n\r\ninterface LoginCredentials {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\ninterface RegisterData {\r\n  email: string;\r\n  username: string;\r\n  password: string;\r\n  telegramUserId?: number;\r\n}\r\n\r\nclass AuthService {\r\n  private users: User[] = []; // Em produção, usar banco de dados\r\n  private jwtSecret: string;\r\n\r\n  constructor() {\r\n    this.jwtSecret = process.env.JWT_SECRET || 'your-super-secret-key';\r\n    this.initializeMockUsers();\r\n  }\r\n\r\n  private initializeMockUsers() {\r\n    // Usuário admin padrão para desenvolvimento\r\n    const adminUser: User = {\r\n      id: '1',\r\n      email: 'admin@autosheets.com',\r\n      username: 'admin',\r\n      password: bcrypt.hashSync('Admin123!', 10),\r\n      role: 'admin',\r\n      createdAt: new Date(),\r\n    };\r\n    \r\n    this.users.push(adminUser);\r\n  }\r\n\r\n  async register(data: RegisterData): Promise<{ success: boolean; message: string; user?: Partial<User> }> {\r\n    try {\r\n      // Validar se email já existe\r\n      if (this.users.find(u => u.email === data.email)) {\r\n        return { success: false, message: 'Email já cadastrado' };\r\n      }\r\n\r\n      // Validar se username já existe\r\n      if (this.users.find(u => u.username === data.username)) {\r\n        return { success: false, message: 'Username já cadastrado' };\r\n      }\r\n\r\n      // Validar força da senha\r\n      if (!this.isPasswordStrong(data.password)) {\r\n        return { \r\n          success: false, \r\n          message: 'Senha deve ter pelo menos 8 caracteres, incluindo maiúscula, minúscula, número e caractere especial' \r\n        };\r\n      }\r\n\r\n      // Criar novo usuário\r\n      const hashedPassword = await bcrypt.hash(data.password, 10);\r\n      const newUser: User = {\r\n        id: (this.users.length + 1).toString(),\r\n        email: data.email,\r\n        username: data.username,\r\n        password: hashedPassword,\r\n        role: 'user',\r\n        telegramUserId: data.telegramUserId,\r\n        createdAt: new Date(),\r\n      };\r\n\r\n      this.users.push(newUser);\r\n\r\n      const { password, ...userWithoutPassword } = newUser;\r\n      return { \r\n        success: true, \r\n        message: 'Usuário criado com sucesso', \r\n        user: userWithoutPassword \r\n      };\r\n    } catch (error) {\r\n      console.error('Erro no registro:', error);\r\n      return { success: false, message: 'Erro interno do servidor' };\r\n    }\r\n  }\r\n\r\n  async login(credentials: LoginCredentials): Promise<{ success: boolean; message: string; token?: string; user?: Partial<User> }> {\r\n    try {\r\n      const user = this.users.find(u => u.email === credentials.email);\r\n      \r\n      if (!user) {\r\n        return { success: false, message: 'Credenciais inválidas' };\r\n      }\r\n\r\n      const isPasswordValid = await bcrypt.compare(credentials.password, user.password);\r\n      \r\n      if (!isPasswordValid) {\r\n        return { success: false, message: 'Credenciais inválidas' };\r\n      }\r\n\r\n      // Atualizar último login\r\n      user.lastLogin = new Date();\r\n\r\n      // Gerar JWT token\r\n      const token = jwt.sign(\r\n        { \r\n          userId: user.id, \r\n          email: user.email, \r\n          role: user.role \r\n        },\r\n        this.jwtSecret,\r\n        { expiresIn: '24h' }\r\n      );\r\n\r\n      const { password, ...userWithoutPassword } = user;\r\n      return { \r\n        success: true, \r\n        message: 'Login realizado com sucesso', \r\n        token,\r\n        user: userWithoutPassword \r\n      };\r\n    } catch (error) {\r\n      console.error('Erro no login:', error);\r\n      return { success: false, message: 'Erro interno do servidor' };\r\n    }\r\n  }\r\n\r\n  async verifyToken(token: string): Promise<{ valid: boolean; user?: Partial<User> }> {\r\n    try {\r\n      const decoded = jwt.verify(token, this.jwtSecret) as any;\r\n      const user = this.users.find(u => u.id === decoded.userId);\r\n      \r\n      if (!user) {\r\n        return { valid: false };\r\n      }\r\n\r\n      const { password, ...userWithoutPassword } = user;\r\n      return { valid: true, user: userWithoutPassword };\r\n    } catch (error) {\r\n      return { valid: false };\r\n    }\r\n  }\r\n\r\n  private isPasswordStrong(password: string): boolean {\r\n    const config = SECURITY_CONFIG.PASSWORD;\r\n    \r\n    if (password.length < config.minLength) return false;\r\n    if (config.requireUppercase && !/[A-Z]/.test(password)) return false;\r\n    if (config.requireLowercase && !/[a-z]/.test(password)) return false;\r\n    if (config.requireNumbers && !/\\d/.test(password)) return false;\r\n    if (config.requireSpecialChars && !/[!@#$%^&*(),.?\":{}|<>]/.test(password)) return false;\r\n    \r\n    return true;\r\n  }\r\n\r\n  getUserByTelegramId(telegramUserId: number): User | undefined {\r\n    return this.users.find(u => u.telegramUserId === telegramUserId);\r\n  }\r\n\r\n  getAllUsers(): Partial<User>[] {\r\n    return this.users.map(({ password, ...user }) => user);\r\n  }\r\n}\r\n\r\nexport default AuthService;\r\nexport type { User, LoginCredentials, RegisterData };"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 314, "column": 0}, "map": {"version":3,"sources":["file:///D:/Documentos/Trae/autosheets/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport AuthService from '@/lib/auth/service';\r\n\r\nconst authService = new AuthService();\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { email, password } = body;\r\n\r\n    if (!email || !password) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Email e senha são obrigatórios' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const result = await authService.login({ email, password });\r\n\r\n    if (result.success) {\r\n      return NextResponse.json(result, { status: 200 });\r\n    } else {\r\n      return NextResponse.json(result, { status: 401 });\r\n    }\r\n  } catch (error) {\r\n    console.error('Erro na API de login:', error);\r\n    return NextResponse.json(\r\n      { success: false, message: 'Erro interno do servidor' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,MAAM,cAAc,IAAI,+HAAA,CAAA,UAAW;AAE5B,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAiC,GAC5D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,YAAY,KAAK,CAAC;YAAE;YAAO;QAAS;QAEzD,IAAI,OAAO,OAAO,EAAE;YAClB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,QAAQ;gBAAE,QAAQ;YAAI;QACjD,OAAO;YACL,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,QAAQ;gBAAE,QAAQ;YAAI;QACjD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAA2B,GACtD;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}