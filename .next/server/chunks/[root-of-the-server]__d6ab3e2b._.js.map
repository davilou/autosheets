{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///D:/Documentos/Trae/autosheets/src/lib/sheets/service.ts"],"sourcesContent":["import { google } from 'googleapis';\r\nimport { BetData } from '../telegram/parser'; // Mudança aqui!\r\nimport { SHEETS_CONFIG } from '../security/config';\r\n\r\ninterface SheetsConfig {\r\n  spreadsheetId: string;\r\n  range: string;\r\n  credentials: {\r\n    client_email: string;\r\n    private_key: string;\r\n  };\r\n}\r\n\r\nclass GoogleSheetsService {\r\n  private sheets: any;\r\n  private auth: any;\r\n  private config: SheetsConfig;\r\n\r\n  constructor(config: SheetsConfig) {\r\n    this.config = config;\r\n    this.initializeAuth();\r\n  }\r\n\r\n  private async initializeAuth() {\r\n    try {\r\n      this.auth = new google.auth.GoogleAuth({\r\n        credentials: this.config.credentials,\r\n        scopes: ['https://www.googleapis.com/auth/spreadsheets'],\r\n      });\r\n\r\n      this.sheets = google.sheets({ version: 'v4', auth: this.auth });\r\n    } catch (error) {\r\n      console.error('Erro ao inicializar autenticação Google Sheets:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async addBetData(betData: BetData): Promise<boolean> {\r\n    try {\r\n      console.log('Dados recebidos para salvar:', betData);\r\n      \r\n      const values = this.formatBetDataForSheets(betData);\r\n      console.log('Valores formatados:', values);\r\n      \r\n      const request = {\r\n        spreadsheetId: this.config.spreadsheetId,\r\n        range: this.config.range,\r\n        valueInputOption: 'USER_ENTERED',\r\n        resource: {\r\n          values: [values],\r\n        },\r\n      };\r\n\r\n      console.log('Enviando para Google Sheets:', request);\r\n      const response = await this.sheets.spreadsheets.values.append(request);\r\n      \r\n      console.log('Resposta do Google Sheets:', response.status, response.statusText);\r\n      \r\n      if (response.status === 200) {\r\n        console.log('✅ Dados adicionados com sucesso ao Google Sheets');\r\n        return true;\r\n      }\r\n      \r\n      console.error('❌ Falha ao adicionar dados - Status:', response.status);\r\n      return false;\r\n    } catch (error) {\r\n      console.error('❌ Erro ao adicionar dados ao Google Sheets:', error);\r\n      if (error instanceof Error && (error as any).response) {\r\n        console.error('Detalhes do erro:', (error as any).response.data);\r\n      }\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async addMultipleBetData(betDataArray: BetData[]): Promise<number> {\r\n    if (betDataArray.length === 0) return 0;\r\n    \r\n    try {\r\n      const values = betDataArray.map(bet => this.formatBetDataForSheets(bet));\r\n      \r\n      const request = {\r\n        spreadsheetId: this.config.spreadsheetId,\r\n        range: this.config.range,\r\n        valueInputOption: 'USER_ENTERED',\r\n        resource: {\r\n          values,\r\n        },\r\n      };\r\n\r\n      const response = await this.sheets.spreadsheets.values.append(request);\r\n      \r\n      if (response.status === 200) {\r\n        console.log(`${betDataArray.length} registros adicionados com sucesso`);\r\n        return betDataArray.length;\r\n      }\r\n      \r\n      return 0;\r\n    } catch (error) {\r\n      console.error('Erro ao adicionar múltiplos dados:', error);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  private formatBetDataForSheets(betData: BetData): any[] {\r\n    // Formatação corrigida para a estrutura real da planilha\r\n    return [\r\n      betData.data instanceof Date \r\n        ? betData.data.toLocaleString('pt-BR') \r\n        : new Date(betData.data).toLocaleString('pt-BR'),    // A - Data\r\n      betData.jogo,                                         // B - Jogo\r\n      betData.placar || '0-0',                              // C - Placar (MUDANÇA: usar \"0-0\" como padrão)\r\n      betData.linha_da_aposta,                              // D - Linha_da_Aposta\r\n      betData.mercado,                                      // E - Mercado\r\n      typeof betData.odd_tipster === 'number' \r\n        ? betData.odd_tipster.toString() \r\n        : betData.odd_tipster,                              // F - Odd_Tipster\r\n      betData.pegou === true ? 'SIM' : \r\n      betData.pegou === false ? 'NÃO' : 'PENDENTE',        // G - Pegou\r\n      betData.odd_real ? betData.odd_real.toString() : '', // H - Odd_Real\r\n      '',                                                   // I - Resultado_Jogo (vazio inicialmente)\r\n      betData.resultado_aposta || 'Pendente',               // J - Resultado_Aposta\r\n    ];\r\n  }\r\n\r\n  async createHeaderRow(): Promise<boolean> {\r\n    try {\r\n      const headers = [\r\n        'Data',                  // A\r\n        'Jogo',                  // B\r\n        'Placar',                // C\r\n        'Linha_da_Aposta',       // D\r\n        'Mercado',               // E\r\n        'Odd_Tipster',           // F\r\n        'Pegou',                 // G\r\n        'Odd_Real',              // H\r\n        'Resultado_Jogo',        // I\r\n        'Resultado_Aposta'       // J\r\n      ];\r\n  \r\n      const request = {\r\n        spreadsheetId: this.config.spreadsheetId,\r\n        range: 'A1:J1',\r\n        valueInputOption: 'USER_ENTERED',\r\n        resource: {\r\n          values: [headers],\r\n        },\r\n      };\r\n  \r\n      const response = await this.sheets.spreadsheets.values.update(request);\r\n      console.log('Cabeçalho criado:', response.status === 200 ? 'Sucesso' : 'Falha');\r\n      return response.status === 200;\r\n    } catch (error) {\r\n      console.error('Erro ao criar cabeçalho:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async getSheetData(range?: string): Promise<any[]> {\r\n    try {\r\n      const response = await this.sheets.spreadsheets.values.get({\r\n        spreadsheetId: this.config.spreadsheetId,\r\n        range: range || this.config.range,\r\n      });\r\n\r\n      return response.data.values || [];\r\n    } catch (error) {\r\n      console.error('Erro ao buscar dados da planilha:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Método para testar a conexão\r\n  async testConnection(): Promise<boolean> {\r\n    try {\r\n      const response = await this.sheets.spreadsheets.get({\r\n        spreadsheetId: this.config.spreadsheetId\r\n      });\r\n      \r\n      console.log('✅ Conexão com Google Sheets OK:', response.data.properties.title);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('❌ Erro na conexão com Google Sheets:', error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nexport default GoogleSheetsService;\r\nexport type { SheetsConfig };"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 349, "column": 0}, "map": {"version":3,"sources":["file:///D:/Documentos/Trae/autosheets/src/lib/gemini/parser.ts"],"sourcesContent":["import { BetData } from '../telegram/parser';\r\n\r\ninterface GeminiResponse {\r\n  candidates: {\r\n    content: {\r\n      parts: {\r\n        text: string;\r\n      }[];\r\n    };\r\n  }[];\r\n}\r\n\r\nexport class GeminiParser {\r\n  private static readonly API_KEY = process.env.GEMINI_API_KEY;\r\n  private static readonly API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';\r\n\r\n  static async parseBetMessage(message: string, chatId: number, userId: number, username: string): Promise<BetData | null> {\r\n    if (!this.API_KEY) {\r\n      console.error('GEMINI_API_KEY não configurada');\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const prompt = `\r\nAnalise esta mensagem de aposta do Telegram e extraia as informações em formato JSON válido.\r\n\r\nMensagem: \"${message}\"\r\n\r\nVocê deve extrair:\r\n- jogo: Os times que estão jogando (formato: \"Time A vs Time B\")\r\n- mercado: Tipo de aposta (\"Goal Line\", \"Asian Handicap\", \"Resultado Final\", \"Over/Under\", etc.)\r\n- linha_da_aposta: A linha específica da aposta (ex: \"GL +0.5\", \"AH -1.0\", \"Over 2.5\", etc.)\r\n- odd_tipster: A odd fornecida pelo tipster (apenas o número, ex: \"1.85\")\r\n- placar: O placar atual do jogo se mencionado na mensagem (ex: \"2x1\", \"1-0\", \"3x2\"). Se não houver placar ou o jogo não tiver começado, use \"0-0\"\r\n\r\nExemplos de formato para linha_da_aposta:\r\n- Goal Line: \"GL +0.5\", \"GL -1.0\", \"GL 0.0\"\r\n- Asian Handicap: \"AH +1.5\", \"AH -0.5\", \"AH 0.0\"\r\n- Over/Under: \"Over 2.5\", \"Under 1.5\"\r\n- Resultado: \"1\", \"X\", \"2\"\r\n\r\nExemplos de placar:\r\n- Se a mensagem menciona \"Flamengo 2x1 Palmeiras\" → placar: \"2x1\"\r\n- Se a mensagem menciona \"jogo começou 1-0\" → placar: \"1x0\"\r\n- Se não menciona placar ou diz \"jogo às 20h\" → placar: \"0-0\"\r\n\r\nRetorne APENAS um JSON válido no formato:\r\n{\r\n  \"jogo\": \"Time A vs Time B\",\r\n  \"mercado\": \"Goal Line\",\r\n  \"linha_da_aposta\": \"GL +0.5\",\r\n  \"odd_tipster\": \"1.85\",\r\n  \"placar\": \"2x1\" ou \"0-0\"\r\n}\r\n\r\nSe não conseguir extrair alguma informação, use null para esse campo (exceto placar que deve ser \"0-0\").`;\r\n\r\n      const response = await fetch(`${this.API_URL}?key=${this.API_KEY}`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          contents: [{\r\n            parts: [{\r\n              text: prompt\r\n            }]\r\n          }],\r\n          generationConfig: {\r\n            temperature: 0.1,\r\n            maxOutputTokens: 300,\r\n          }\r\n        })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text();\r\n        console.error('Erro na API do Gemini:', response.status, response.statusText, errorText);\r\n        return null;\r\n      }\r\n\r\n      const result: GeminiResponse = await response.json();\r\n      \r\n      if (!result.candidates || result.candidates.length === 0) {\r\n        console.error('Nenhuma resposta do Gemini');\r\n        return null;\r\n      }\r\n\r\n      const text = result.candidates[0].content.parts[0].text;\r\n      console.log('Resposta do Gemini:', text);\r\n\r\n      // Extrair JSON da resposta\r\n      const jsonMatch = text.match(/\\{[\\s\\S]*?\\}/);\r\n      if (!jsonMatch) {\r\n        console.error('JSON não encontrado na resposta do Gemini');\r\n        return null;\r\n      }\r\n\r\n      let parsedData;\r\n      try {\r\n        parsedData = JSON.parse(jsonMatch[0]);\r\n      } catch (parseError) {\r\n        console.error('Erro ao fazer parse do JSON:', parseError);\r\n        return null;\r\n      }\r\n\r\n      // Validar dados essenciais\r\n      if (!parsedData.jogo || !parsedData.odd_tipster) {\r\n        console.error('Dados essenciais não encontrados');\r\n        return null;\r\n      }\r\n\r\n      return {\r\n        id: `${chatId}_${userId}_${Date.now()}`,\r\n        chatId,\r\n        userId,\r\n        username,\r\n        message,\r\n        data: new Date(),\r\n        jogo: parsedData.jogo,\r\n        mercado: parsedData.mercado || 'Pendente',\r\n        linha_da_aposta: parsedData.linha_da_aposta || 'Não identificado',\r\n        odd_tipster: parseFloat(parsedData.odd_tipster),\r\n        placar: parsedData.placar || '0-0', // MUDANÇA: usar \"0-0\" ao invés de \"Pré\"\r\n        pegou: null,\r\n        odd_real: null,\r\n        resultado_aposta: 'Pendente'\r\n      };\r\n    } catch (error) {\r\n      console.error('Erro ao processar mensagem com Gemini:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async parseImageMessage(imageUrl: string, caption: string, chatId: number, userId: number, username: string): Promise<BetData | null> {\r\n    if (!this.API_KEY) {\r\n      console.error('GEMINI_API_KEY não configurada');\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      console.log('🖼️ Analisando imagem com Gemini:', imageUrl);\r\n      \r\n      // Baixar a imagem e converter para base64\r\n      const imageResponse = await fetch(imageUrl);\r\n      if (!imageResponse.ok) {\r\n        console.error('Erro ao baixar imagem:', imageResponse.status);\r\n        return null;\r\n      }\r\n      \r\n      const imageBuffer = await imageResponse.arrayBuffer();\r\n      const base64Image = Buffer.from(imageBuffer).toString('base64');\r\n      \r\n      const prompt = `\r\nAnalise esta imagem de aposta esportiva e extraia as informações em formato JSON válido.\r\n\r\n${caption ? `Legenda da imagem: \"${caption}\"` : ''}\r\n\r\nVocê deve extrair:\r\n- jogo: Os times que estão jogando (formato: \"Time A vs Time B\")\r\n- mercado: Tipo de aposta (\"Goal Line\", \"Asian Handicap\", \"Resultado Final\", \"Over/Under\", etc.)\r\n- linha_da_aposta: A linha específica da aposta (ex: \"GL +0.5\", \"AH -1.0\", \"Over 2.5\", etc.)\r\n- odd_tipster: A odd fornecida pelo tipster (apenas o número, ex: \"1.85\")\r\n- placar: O placar atual do jogo se visível na imagem (ex: \"2x1\", \"1-0\", \"3x2\"). Se não houver placar ou o jogo não tiver começado, use \"0-0\"\r\n\r\nExemplos de formato para linha_da_aposta:\r\n- Goal Line: \"GL +0.5\", \"GL -1.0\", \"GL 0.0\"\r\n- Asian Handicap: \"AH +1.5\", \"AH -0.5\", \"AH 0.0\"\r\n- Over/Under: \"Over 2.5\", \"Under 1.5\"\r\n- Resultado: \"1\", \"X\", \"2\"\r\n\r\nRetorne APENAS um JSON válido no formato:\r\n{\r\n  \"jogo\": \"Time A vs Time B\",\r\n  \"mercado\": \"Goal Line\",\r\n  \"linha_da_aposta\": \"GL +0.5\",\r\n  \"odd_tipster\": \"1.85\",\r\n  \"placar\": \"2x1\" ou \"0-0\"\r\n}\r\n\r\nSe não conseguir extrair alguma informação, use null para esse campo (exceto placar que deve ser \"0-0\").`;\r\n\r\n      const response = await fetch(`${this.API_URL}?key=${this.API_KEY}`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          contents: [{\r\n            parts: [\r\n              {\r\n                text: prompt\r\n              },\r\n              {\r\n                inline_data: {\r\n                  mime_type: 'image/jpeg',\r\n                  data: base64Image\r\n                }\r\n              }\r\n            ]\r\n          }],\r\n          generationConfig: {\r\n            temperature: 0.1,\r\n            maxOutputTokens: 300,\r\n          }\r\n        })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text();\r\n        console.error('Erro na API do Gemini:', response.status, response.statusText, errorText);\r\n        return null;\r\n      }\r\n\r\n      const result: GeminiResponse = await response.json();\r\n      \r\n      if (!result.candidates || result.candidates.length === 0) {\r\n        console.error('Nenhuma resposta do Gemini para imagem');\r\n        return null;\r\n      }\r\n\r\n      const text = result.candidates[0].content.parts[0].text;\r\n      console.log('Resposta do Gemini para imagem:', text);\r\n\r\n      // Extrair JSON da resposta\r\n      const jsonMatch = text.match(/\\{[\\s\\S]*?\\}/);\r\n      if (!jsonMatch) {\r\n        console.error('JSON não encontrado na resposta do Gemini para imagem');\r\n        return null;\r\n      }\r\n\r\n      let parsedData;\r\n      try {\r\n        parsedData = JSON.parse(jsonMatch[0]);\r\n      } catch (parseError) {\r\n        console.error('Erro ao fazer parse do JSON da imagem:', parseError);\r\n        return null;\r\n      }\r\n      \r\n      // Criar objeto BetData\r\n      const betData: BetData = {\r\n        id: `bet_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        chatId,\r\n        userId,\r\n        username,\r\n        message: caption || '[Imagem de aposta]',\r\n        data: new Date(),\r\n        jogo: parsedData.jogo || 'Não identificado',\r\n        mercado: parsedData.mercado || 'Pendente',\r\n        linha_da_aposta: parsedData.linha_da_aposta || 'Não identificado',\r\n        odd_tipster: parseFloat(parsedData.odd_tipster) || 0,\r\n        placar: parsedData.placar || '0-0', // ADICIONADO: incluir o placar\r\n        pegou: null,\r\n        odd_real: null,\r\n        resultado_aposta: 'Pendente'\r\n      };\r\n\r\n      return betData;\r\n\r\n    } catch (error) {\r\n      console.error('Erro ao analisar imagem com Gemini:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static createConfirmationMessage(betData: BetData): string {\r\n    return `🎯 *Aposta detectada!*\\n\\n` +\r\n           `🏆 *Jogo:* ${betData.jogo}\\n` +\r\n           `📊 *Mercado:* ${betData.mercado}\\n` +\r\n           `🎲 *Linha:* ${betData.linha_da_aposta}\\n` +\r\n           `💰 *Odd Tipster:* ${betData.odd_tipster}\\n` +\r\n           `⚽ *Placar:* ${betData.placar}\\n\\n` +\r\n           `❓ Você pegou essa aposta? (Responda: sim/não)`;\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 592, "column": 0}, "map": {"version":3,"sources":["file:///D:/Documentos/Trae/autosheets/src/app/api/telegram/webhook/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport GoogleSheetsService from '@/lib/sheets/service';\r\nimport { GeminiParser } from '@/lib/gemini/parser';\r\nimport { BetData } from '@/lib/telegram/parser';\r\n\r\nconst sheetsConfig = {\r\n  spreadsheetId: process.env.GOOGLE_SHEETS_ID!,\r\n  range: 'Apostas!A:J',\r\n  credentials: {\r\n    client_email: process.env.GOOGLE_CLIENT_EMAIL!,\r\n    private_key: (process.env.GOOGLE_PRIVATE_KEY || '').replace(/\\\\n/g, '\\n'),\r\n  },\r\n};\r\n\r\nconst sheetsService = new GoogleSheetsService(sheetsConfig);\r\n\r\n// Cache para armazenar apostas por message_id do bot\r\nconst pendingBets = new Map<string, BetData>();\r\n\r\n// NOVO: Método GET para teste\r\nexport async function GET() {\r\n  return NextResponse.json({\r\n    status: 'Webhook ativo! 🤖',\r\n    timestamp: new Date().toISOString(),\r\n    message: 'Este endpoint está funcionando corretamente para receber webhooks do Telegram.'\r\n  });\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  console.log('🔄 Webhook recebido');\r\n  \r\n  try {\r\n    const update = await request.json();\r\n    console.log('📦 Update recebido:', JSON.stringify(update, null, 2));\r\n    \r\n    const message = update.message;\r\n    \r\n    // NOVO: Processar mensagens com foto\r\n    if (message && message.photo) {\r\n      console.log('📸 Imagem recebida, processando...');\r\n      \r\n      const chatId = message.chat.id;\r\n      const userId = message.from.id;\r\n      const username = message.from.username;\r\n      \r\n      // Pegar a foto de maior resolução\r\n      const photo = message.photo[message.photo.length - 1];\r\n      const fileId = photo.file_id;\r\n      \r\n      console.log(`📷 Processando imagem de ${username} (${userId}), fileId: ${fileId}`);\r\n      \r\n      try {\r\n        // Obter URL da imagem\r\n        const imageUrl = await getTelegramFileUrl(fileId);\r\n        console.log('🔗 URL da imagem:', imageUrl);\r\n        \r\n        // Processar com Gemini AI\r\n        console.log('🤖 Analisando imagem com Gemini AI...');\r\n        const betData = await GeminiParser.parseImageMessage(\r\n          imageUrl,\r\n          message.caption || '', // Texto que acompanha a imagem (se houver)\r\n          chatId,\r\n          userId,\r\n          username\r\n        );\r\n        \r\n        console.log('🎯 Resultado da análise da imagem:', betData);\r\n        \r\n        if (betData) {\r\n          console.log('✅ Aposta detectada na imagem pela IA:', betData);\r\n          \r\n          // Enviar mensagem perguntando a odd\r\n          const sentMessage = await sendTelegramMessage(\r\n            chatId, \r\n            `🎯 **Aposta detectada na imagem!**\\n\\n` +\r\n            `⚽ **Jogo:** ${betData.jogo}\\n` +\r\n            `⚽ **Placar:** ${betData.placar}\\n` +\r\n            `📊 **Mercado:** ${betData.mercado}\\n` +\r\n            `📈 **Linha:** ${betData.linha_da_aposta}\\n` +\r\n            `💰 **Odd Tipster:** ${betData.odd_tipster}\\n\\n` +\r\n            `💎 **Responda esta mensagem com a odd real que você conseguiu**\\n` +\r\n            `(Digite 0 se não conseguiu pegar a aposta)`\r\n          );\r\n          \r\n          // Salvar aposta usando o message_id da resposta do bot\r\n          if (sentMessage && sentMessage.result) {\r\n            const botMessageId = sentMessage.result.message_id;\r\n            const betKey = `${chatId}_${botMessageId}`;\r\n            pendingBets.set(betKey, betData);\r\n            \r\n            console.log(`📤 Aposta da imagem salva com chave: ${betKey}`);\r\n          }\r\n        } else {\r\n          console.log('❌ Imagem não reconhecida como aposta válida pela IA');\r\n          await sendTelegramMessage(\r\n            chatId,\r\n            '🤖 Recebi sua imagem, mas não consegui identificar uma aposta. Logs disponíveis no servidor.'\r\n          );\r\n        }\r\n      } catch (error) {\r\n        console.error('❌ Erro ao processar imagem:', error);\r\n        await sendTelegramMessage(\r\n          chatId,\r\n          '❌ **Erro ao processar imagem**\\n\\nHouve um problema ao analisar sua imagem. Tente novamente.'\r\n        );\r\n      }\r\n      \r\n      return NextResponse.json({ ok: true });\r\n    }\r\n    \r\n    // Processar mensagens de texto\r\n    if (update.message && update.message.text) {\r\n      const chatId = update.message.chat.id;\r\n      const userId = update.message.from.id;\r\n      const username = update.message.from.username;\r\n      const messageText = update.message.text;\r\n      const messageId = update.message.message_id;\r\n      \r\n      console.log(`📨 Mensagem de ${username} (${userId}): \"${messageText}\"`);\r\n      \r\n      // 1. Verificar se é uma resposta (reply) a uma mensagem de aposta\r\n      if (message.reply_to_message) {\r\n        const repliedMessageId = message.reply_to_message.message_id;\r\n        const betKey = `${chatId}_${repliedMessageId}`;\r\n        \r\n        if (pendingBets.has(betKey)) {\r\n          console.log('💰 Processando odd em resposta à aposta...');\r\n          await handleOddReply(update, betKey);\r\n          return NextResponse.json({ ok: true });\r\n        }\r\n      }\r\n      \r\n      // 2. Processar nova mensagem de aposta com IA\r\n      console.log('🤖 Analisando mensagem com Gemini AI...');\r\n      console.log('🔑 GEMINI_API_KEY configurada:', !!process.env.GEMINI_API_KEY);\r\n      \r\n      const betData = await GeminiParser.parseBetMessage(\r\n        messageText, \r\n        chatId, \r\n        userId, \r\n        username\r\n      );\r\n      \r\n      console.log('🎯 Resultado da análise:', betData);\r\n      \r\n      if (betData) {\r\n        console.log('✅ Nova aposta detectada pela IA:', betData);\r\n        \r\n        // Enviar mensagem perguntando a odd\r\n        const sentMessage = await sendTelegramMessage(\r\n          chatId, \r\n          `🎯 **Aposta detectada!**\\n\\n` +\r\n          `⚽ **Jogo:** ${betData.jogo}\\n` +\r\n          `⚽ **Placar:** ${betData.placar}\\n` +\r\n          `📊 **Mercado:** ${betData.mercado}\\n` +\r\n          `📈 **Linha:** ${betData.linha_da_aposta}\\n` +\r\n          `💰 **Odd Tipster:** ${betData.odd_tipster}\\n\\n` +\r\n          `💎 **Responda esta mensagem com a odd real que você conseguiu**\\n` +\r\n          `(Digite 0 se não conseguiu pegar a aposta)`\r\n        );\r\n        \r\n        // Salvar aposta usando o message_id da resposta do bot\r\n        if (sentMessage && sentMessage.result) {\r\n          const botMessageId = sentMessage.result.message_id;\r\n          const betKey = `${chatId}_${botMessageId}`;\r\n          pendingBets.set(betKey, betData);\r\n          \r\n          console.log(`📤 Aposta salva com chave: ${betKey}`);\r\n        }\r\n      } else {\r\n        console.log('❌ Mensagem não reconhecida como aposta válida pela IA');\r\n        await sendTelegramMessage(\r\n          chatId,\r\n          '🤖 Recebi sua mensagem, mas não consegui identificar uma aposta. Logs disponíveis no servidor.'\r\n        );\r\n      }\r\n    }\r\n    \r\n    return NextResponse.json({ ok: true });\r\n  } catch (error) {\r\n    console.error('❌ Erro no webhook:', error);\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\r\n  }\r\n}\r\n\r\nasync function handleOddReply(update: any, betKey: string) {\r\n  const chatId = update.message.chat.id;\r\n  const messageText = update.message.text.trim();\r\n  \r\n  const betData = pendingBets.get(betKey);\r\n  if (!betData) {\r\n    console.log('❌ Dados da aposta não encontrados');\r\n    await sendTelegramMessage(\r\n      chatId,\r\n      '❌ **Aposta não encontrada**\\n\\nEsta aposta pode ter expirado ou já foi processada.'\r\n    );\r\n    return;\r\n  }\r\n  \r\n  const oddReal = parseFloat(messageText.replace(',', '.'));\r\n  console.log(`📊 Odd recebida: ${messageText} -> ${oddReal}`);\r\n  \r\n  if (oddReal === 0) {\r\n    // Aposta não foi pega\r\n    betData.pegou = false;\r\n    betData.odd_real = null;\r\n    \r\n    // Salvar no Google Sheets mesmo quando não pegou\r\n    const success = await sheetsService.addBetData(betData);\r\n    \r\n    await sendTelegramMessage(\r\n      chatId,\r\n      `❌ **Aposta não realizada**\\n\\n` +\r\n      `⚽ **Jogo:** ${betData.jogo}\\n` +\r\n      `⚽ **Placar:** ${betData.placar}\\n` +\r\n      `📊 **Mercado:** ${betData.mercado}\\n` +\r\n      `📈 **Linha:** ${betData.linha_da_aposta}\\n` +\r\n      `💰 **Odd Tipster:** ${betData.odd_tipster}\\n\\n` +\r\n      `Registrado que a aposta não foi pega.`\r\n    );\r\n    \r\n    console.log('❌ Aposta marcada como não realizada');\r\n  } else if (!isNaN(oddReal) && oddReal > 0) {\r\n    // Aposta foi pega com odd válida\r\n    betData.pegou = true;\r\n    betData.odd_real = oddReal;\r\n    \r\n    console.log('💾 Salvando aposta no Google Sheets:', betData);\r\n    \r\n    // Testar conexão e salvar\r\n    const connectionOk = await sheetsService.testConnection();\r\n    if (!connectionOk) {\r\n      console.error('❌ Falha na conexão com Google Sheets');\r\n      await sendTelegramMessage(chatId, '❌ **Erro de conexão**\\n\\nNão foi possível conectar ao Google Sheets.');\r\n      return;\r\n    }\r\n    \r\n    const success = await sheetsService.addBetData(betData);\r\n    \r\n    if (success) {\r\n      await sendTelegramMessage(\r\n        chatId,\r\n        `✅ **Aposta registrada com sucesso!**\\n\\n` +\r\n        `⚽ **Jogo:** ${betData.jogo}\\n` +\r\n        `⚽ **Placar:** ${betData.placar}\\n` +\r\n        `📊 **Mercado:** ${betData.mercado}\\n` +\r\n        `📈 **Linha:** ${betData.linha_da_aposta}\\n` +\r\n        `💰 **Odd Tipster:** ${betData.odd_tipster}\\n` +\r\n        `💎 **Odd Real:** ${betData.odd_real}\\n` +\r\n        `📊 **Status:** ${betData.resultado_aposta}`\r\n      );\r\n      \r\n      console.log('✅ Aposta salva com sucesso');\r\n    } else {\r\n      await sendTelegramMessage(\r\n        chatId,\r\n        `❌ **Erro ao salvar**\\n\\nHouve erro ao salvar no Google Sheets. Verifique os logs.`\r\n      );\r\n      \r\n      console.error('❌ Falha ao salvar no Google Sheets');\r\n    }\r\n  } else {\r\n    // Odd inválida\r\n    await sendTelegramMessage(\r\n      chatId,\r\n      `❌ **Odd inválida**\\n\\nPor favor, responda com um número válido ou 0 para \\\"não peguei\\\".\\n\\nExemplos: 1.85, 2.50, 0`\r\n    );\r\n    console.log('❌ Odd inválida, aguardando nova resposta');\r\n    return; // Não remove do cache, aguarda nova resposta\r\n  }\r\n  \r\n  // Remove do cache após processar\r\n  pendingBets.delete(betKey);\r\n  console.log(`🗑️ Aposta removida do cache: ${betKey}`);\r\n}\r\n\r\nasync function sendTelegramMessage(chatId: number, text: string) {\r\n  const botToken = process.env.TELEGRAM_BOT_TOKEN!;\r\n  \r\n  try {\r\n    console.log(`Enviando mensagem para chat ${chatId}:`, text);\r\n    \r\n    const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        chat_id: chatId,\r\n        text: text,\r\n        parse_mode: 'Markdown'\r\n      })\r\n    });\r\n    \r\n    const result = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      console.error('Erro na API do Telegram:', result);\r\n    } else {\r\n      console.log('Mensagem enviada com sucesso');\r\n    }\r\n    \r\n    return result;\r\n  } catch (error) {\r\n    console.error('Erro ao enviar mensagem:', error);\r\n  }\r\n}\r\n\r\nasync function getTelegramFileUrl(fileId: string): Promise<string> {\r\n  const response = await fetch(\r\n    `https://api.telegram.org/bot${process.env.TELEGRAM_BOT_TOKEN}/getFile?file_id=${fileId}`\r\n  );\r\n  const data = await response.json();\r\n  return `https://api.telegram.org/file/bot${process.env.TELEGRAM_BOT_TOKEN}/${data.result.file_path}`;\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}