"use strict";(()=>{var a={};a.id=4425,a.ids=[4425,5376,7259,9640],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},1708:a=>{a.exports=require("node:process")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:a=>{a.exports=require("node:buffer")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},10974:(a,b,c)=>{function d(a){return a?a.trim().replace(/\s*[xX√ó]\s*/g,"-").replace(/\s*-\s*/g,"-"):"0-0"}function e(a){if("string"==typeof a){let b=parseFloat(a.replace(",","."));if(isNaN(b))return a;a=b}return a.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}c.d(b,{S:()=>d,V:()=>e})},11723:a=>{a.exports=require("querystring")},12412:a=>{a.exports=require("assert")},14026:a=>{a.exports=require("net")},16141:a=>{a.exports=require("node:zlib")},19771:a=>{a.exports=require("process")},21820:a=>{a.exports=require("os")},27910:a=>{a.exports=require("stream")},28354:a=>{a.exports=require("util")},29021:a=>{a.exports=require("fs")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{a.exports=require("path")},34631:a=>{a.exports=require("tls")},37067:a=>{a.exports=require("node:http")},37830:a=>{a.exports=require("node:stream/web")},44708:a=>{a.exports=require("node:https")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},55591:a=>{a.exports=require("https")},57075:a=>{a.exports=require("node:stream")},57975:a=>{a.exports=require("node:util")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67259:(a,b,c)=>{c.r(b),c.d(b,{default:()=>g});var d=c(25976),e=c(10974);class f{constructor(a){this.config=a,this.initializeAuth()}async initializeAuth(){try{this.auth=new d.q7g.auth.GoogleAuth({credentials:this.config.credentials,scopes:["https://www.googleapis.com/auth/spreadsheets"]}),this.sheets=d.q7g.sheets({version:"v4",auth:this.auth})}catch(a){throw console.error("Erro ao inicializar autentica\xe7\xe3o Google Sheets:",a),a}}ensureText(a){let b=(a??"").toString();return b.startsWith("'")?b:"'"+b}normalizeNumericId(a){let b=(a??"").toString().trim().replace(/^'/,"");if(/^\d+$/.test(b)){let a=b.replace(/^0+/,"");return a.length>0?a:"0"}return b}isBetIdMatch(a,b){let c=(a??"").toString().trim().replace(/^'/,""),d=(b??"").toString().trim().replace(/^'/,"");if(c===d)return!0;let e=/^\d+$/.test(c),f=/^\d+$/.test(d);return!!e&&!!f&&this.normalizeNumericId(c)===this.normalizeNumericId(d)}buildLinhaDaApostaForSheets(a){try{let b=(a.linha_da_aposta||"").trim(),c=(a.mercado||"").trim();if(!b)return b;if("Resultado Final"===c){let c=(a.jogo||"").trim();if(!c)return b;let d=c.split(/\s+(?:vs|x|vs\.|√ó|‚Äî|‚Äì|-|‚Äî)\s+/i),e=(d[0]||"").trim(),f=(d[1]||"").trim();if(!e&&!f)return b;let g=b.toUpperCase();if("1"===g)return e||b;if("2"===g)return f||b;if("X"===g)return"Empate";return b}if("Asian Handicap"!==c)return b;let d=(a.jogo||"").trim();if(!d)return b;let e=d.split(/\s+(?:vs|x|vs\.|√ó|‚Äî|‚Äì|-|‚Äî)\s+/i),f=(e[0]||"").trim(),g=(e[1]||"").trim();if(!f&&!g)return b;let h=a=>a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(),i=h(a.message||""),j=h(f),k=h(g),l=i.indexOf("ah"),m=i.indexOf("hc"),n=i.indexOf("handicap"),o=(()=>{let a=i.match(/([+\-]\d+(?:[\.,]\d+)?)/);return a?i.indexOf(a[1]):-1})(),p=[l,m,n,o].filter(a=>a>=0),q=p.length?Math.min(...p):-1,r=j?i.indexOf(j):-1,s=k?i.indexOf(k):-1,t=null;if(r>=0&&s<0)t=f;else if(s>=0&&r<0)t=g;else if(r>=0&&s>=0&&q>=0){let a=Math.abs(q-r),b=Math.abs(q-s);t=a<=b?f:g}if(!t&&(r>s&&r>=0?t=f:s>r&&s>=0&&(t=g)),!t)return b;let u=b.replace(/AH\s*/i,a=>a.trim().toUpperCase());return`${u} ${t}`.trim()}catch(b){return a.linha_da_aposta}}async addBetData(a){try{this.sheets||await this.initializeAuth(),console.log("Dados recebidos para salvar:",a);let b=this.formatBetDataForSheets(a);console.log("Valores formatados:",b);let c={spreadsheetId:this.config.spreadsheetId,range:this.config.range,valueInputOption:"USER_ENTERED",resource:{values:[b]}};console.log("Enviando para Google Sheets:",c);let d=await this.sheets.spreadsheets.values.append(c);if(console.log("Resposta do Google Sheets:",d.status,d.statusText),200===d.status)return console.log("‚úÖ Dados adicionados com sucesso ao Google Sheets"),!0;return console.error("‚ùå Falha ao adicionar dados - Status:",d.status),!1}catch(a){return console.error("‚ùå Erro ao adicionar dados ao Google Sheets:",a),a instanceof Error&&a.response&&console.error("Detalhes do erro:",a.response.data),!1}}async addMultipleBetData(a){if(0===a.length)return 0;try{let b=a.map(a=>this.formatBetDataForSheets(a)),c={spreadsheetId:this.config.spreadsheetId,range:this.config.range,valueInputOption:"USER_ENTERED",resource:{values:b}},d=await this.sheets.spreadsheets.values.append(c);if(200===d.status)return console.log(`${a.length} registros adicionados com sucesso`),a.length;return 0}catch(a){return console.error("Erro ao adicionar m\xfaltiplos dados:",a),0}}formatBetDataForSheets(a){let b=a.data instanceof Date?a.data:new Date(a.data),c=this.buildLinhaDaApostaForSheets(a);return[this.ensureText(a.betId||""),b.toLocaleDateString("pt-BR"),b.toLocaleTimeString("pt-BR"),a.jogo,(0,e.S)(a.placar||"0-0"),a.mercado,c,"number"==typeof a.odd_tipster?(0,e.V)(a.odd_tipster):a.odd_tipster,!0===a.pegou?"Sim":!1===a.pegou?"N\xe3o":"",a.odd_real&&a.odd_real>0?(0,e.V)(a.odd_real):"",void 0!==a.stake?"number"==typeof a.stake?a.stake.toString().replace(".",","):String(a.stake).replace(".",","):"",a.groupName||"","Pendente"]}async createHeaderRow(){try{let a={spreadsheetId:this.config.spreadsheetId,range:"A1:M1",valueInputOption:"USER_ENTERED",resource:{values:[["BetId","Data","Hora","Jogo","Placar","Mercado","Linha_da_Aposta","Odd_Tipster","Pegou","Odd_Real","Valor_Apostado","Grupo","Resultado"]]}},b=await this.sheets.spreadsheets.values.update(a);return console.log("Cabe\xe7alho criado:",200===b.status?"Sucesso":"Falha"),200===b.status}catch(a){return console.error("Erro ao criar cabe\xe7alho:",a),!1}}async updateResultado(a,b){try{let c=`M${a}:M${a}`,d=await this.sheets.spreadsheets.values.update({spreadsheetId:this.config.spreadsheetId,range:c,valueInputOption:"USER_ENTERED",requestBody:{values:[[b]]}});return 200===d.status}catch(a){return console.error("Erro ao atualizar Resultado:",a),!1}}async getSheetData(a){try{return(await this.sheets.spreadsheets.values.get({spreadsheetId:this.config.spreadsheetId,range:a||this.config.range})).data.values||[]}catch(a){return console.error("Erro ao buscar dados da planilha:",a),[]}}async updateBetOddByBetId(a,b,c){try{console.log("\uD83D\uDD0D Procurando aposta por betId:",a);let d=await this.getSheetData();if(0===d.length)return console.error("‚ùå Planilha vazia ou sem dados"),!1;console.log(`üìã Total de linhas na planilha: ${d.length}`);let f=-1,g=(a??"").toString();for(let a=1;a<d.length;a++){let b=d[a][0];if(this.isBetIdMatch(b,g)){f=a+1,console.log(`üéØ Aposta encontrada na linha ${f} com betId (planilha vs alvo):`,b,g);break}}if(-1===f)return console.log(`‚ùå Aposta com betId ${a} n\xe3o encontrada na planilha`),!1;let h=null===b||0===b?"N\xe3o":"Sim",i=b&&b>0?(0,e.V)(b):"",j=b&&b>0&&void 0!==c?c.toString().replace(".",","):void 0,k=void 0===j?`I${f}:J${f}`:`I${f}:K${f}`,l=await this.sheets.spreadsheets.values.update({spreadsheetId:this.config.spreadsheetId,range:k,valueInputOption:"USER_ENTERED",requestBody:{values:void 0===j?[[h,i]]:[[h,i,j]]}});return console.log("\uD83D\uDCCC Atualiza\xe7\xe3o de odd conclu\xedda:",200===l.status?"Sucesso":"Falha"),200===l.status}catch(a){return console.error("‚ùå Erro ao atualizar odd na planilha:",a),!1}}async updateBetOdd(a,b){try{return this.updateBetOddByBetId(a.betId,b,a.stake)}catch(a){return console.error("Erro ao atualizar odd de betData:",a),!1}}async testConnection(){try{let a=await this.sheets.spreadsheets.get({spreadsheetId:this.config.spreadsheetId});return 200===a.status}catch(a){return console.error("Erro ao testar conex\xe3o com Google Sheets:",a),!1}}}let g=f},73024:a=>{a.exports=require("node:fs")},73136:a=>{a.exports=require("node:url")},73496:a=>{a.exports=require("http2")},73566:a=>{a.exports=require("worker_threads")},74075:a=>{a.exports=require("zlib")},76760:a=>{a.exports=require("node:path")},77030:a=>{a.exports=require("node:net")},78657:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>I,patchFetch:()=>H,routeModule:()=>D,serverHooks:()=>G,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>F});var d={};c.r(d),c.d(d,{GET:()=>B,POST:()=>C});var e=c(96559),f=c(48088),g=c(37719),h=c(26191),i=c(81289),j=c(261),k=c(92603),l=c(39893),m=c(14823),n=c(47220),o=c(66946),p=c(47912),q=c(99786),r=c(46143),s=c(86439),t=c(43365),u=c(32190),v=c(67259),w=c(94705),x=c(95376);let y=new w.A,z=new x.default;async function A(a){let b=a.headers.get("authorization");if(!b||!b.startsWith("Bearer "))return null;let c=b.substring(7),d=await y.verifyToken(c);return d.success?d.user:null}async function B(a){try{let b=await A(a);if(!b)return u.NextResponse.json({success:!1,message:"Token inv\xe1lido ou expirado"},{status:401});let c=await z.getUserActiveSpreadsheet(b.id);if(!c)return u.NextResponse.json({success:!0,data:[],message:"Usu\xe1rio n\xe3o possui planilha ativa"});let d={spreadsheetId:c,range:"Dados!A:M",credentials:{client_email:process.env.GOOGLE_CLIENT_EMAIL,private_key:(process.env.GOOGLE_PRIVATE_KEY||"").replace(/\\n/g,"\n")}},e=new v.default(d),f=await e.getSheetData();return u.NextResponse.json({success:!0,data:f})}catch(a){return console.error("Erro ao buscar dados:",a),u.NextResponse.json({success:!1,message:"Erro interno do servidor"},{status:500})}}async function C(a){try{let b=await A(a);if(!b)return u.NextResponse.json({success:!1,message:"Token inv\xe1lido ou expirado"},{status:401});let{action:d,betData:e}=await a.json();if(!d)return u.NextResponse.json({success:!1,message:"A\xe7\xe3o \xe9 obrigat\xf3ria"},{status:400});if("reapply-resultado-validation"===d){let a=await z.reapplyResultadoValidationForUser(b.id);return u.NextResponse.json({success:a.success,updated:a.updated,errors:a.errors})}let f=await z.getUserActiveSpreadsheet(b.id);if(!f)return u.NextResponse.json({success:!1,message:"Planilha n\xe3o configurada para este usu\xe1rio"},{status:404});console.log("\uD83D\uDCCA A\xe7\xe3o na planilha do usu\xe1rio:",d);let g=new(await Promise.resolve().then(c.bind(c,67259))).default({spreadsheetId:f,range:"Dados!A:M",credentials:{client_email:process.env.GOOGLE_CLIENT_EMAIL,private_key:(process.env.GOOGLE_PRIVATE_KEY||"").replace(/\\n/g,"\n")}});if("append"===d){let a=await g.addBetData(e);return u.NextResponse.json({success:a,message:a?"Dados adicionados com sucesso":"Falha ao adicionar dados"})}if("update-odd"===d){let{betId:a,oddReal:b,stake:c}=e||{};if(!a)return u.NextResponse.json({success:!1,message:"betId \xe9 obrigat\xf3rio para update-odd"},{status:400});let d=await g.updateBetOddByBetId(a,b??null,c);return u.NextResponse.json({success:d,message:d?"Odd atualizada com sucesso":"Falha ao atualizar odd"})}if("update-result"===d){let{rowNumber:a,resultado:b}=e||{};if(!a||!b)return u.NextResponse.json({success:!1,message:"rowNumber e resultado s\xe3o obrigat\xf3rios para update-result"},{status:400});let c=await g.updateResultado(a,b);return u.NextResponse.json({success:c,message:c?"Resultado atualizado":"Falha ao atualizar resultado"})}return u.NextResponse.json({success:!1,message:"A\xe7\xe3o inv\xe1lida"},{status:400})}catch(a){return console.error("Erro ao processar a\xe7\xe3o na planilha:",a),u.NextResponse.json({success:!1,message:"Erro interno do servidor"},{status:500})}}let D=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/sheets/data/route",pathname:"/api/sheets/data",filename:"route",bundlePath:"app/api/sheets/data/route"},distDir:".next",projectDir:"",resolvedPagePath:"D:\\Documentos\\Trae\\autosheets\\src\\app\\api\\sheets\\data\\route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:E,workUnitAsyncStorage:F,serverHooks:G}=D;function H(){return(0,g.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:F})}async function I(a,b,c){var d;let e="/api/sheets/data/route";"/index"===e&&(e="/");let g=await D.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,E=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[E]||y.routes[C]);if(F&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||D.isDev||x||(G="/index"===(G=C)?"/":G);let H=!0===D.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>D.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>D.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await D.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await D.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||await D.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},79646:a=>{a.exports=require("child_process")},81630:a=>{a.exports=require("http")},83997:a=>{a.exports=require("tty")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},94735:a=>{a.exports=require("events")},95376:(a,b,c)=>{c.r(b),c.d(b,{default:()=>g});var d=c(68791),e=c(5069);class f{constructor(){this.driveService=null;let a=process.env.MASTER_GOOGLE_ACCESS_TOKEN,b=process.env.MASTER_GOOGLE_REFRESH_TOKEN;try{a&&b?(this.driveService=new d.default({oauth:{access_token:a,refresh_token:b}}),(async()=>{try{await this.driveService.initialize()}catch(a){console.error("‚ö†Ô∏è Erro ao inicializar Google Drive Service (conta mestre):",a),this.driveService=null}})()):(console.warn("‚ö†Ô∏è Tokens OAuth2 da conta mestre n\xe3o configurados (MASTER_GOOGLE_ACCESS_TOKEN/MASTER_GOOGLE_REFRESH_TOKEN)."),this.driveService=null)}catch(a){console.error("‚ö†Ô∏è Erro ao criar inst\xe2ncia do Google Drive Service (conta mestre):",a)}}async createUserSpreadsheet(a,b,c,f){try{console.log("\uD83D\uDCCA Criando planilha para usu\xe1rio:",a);let g=this.driveService;if(g)console.log("‚úÖ Usando conta mestre (OAuth2) para criar a planilha");else{let a=process.env.MASTER_GOOGLE_ACCESS_TOKEN,b=process.env.MASTER_GOOGLE_REFRESH_TOKEN;if(!a||!b)return console.error("‚ùå Tokens OAuth2 da conta mestre n\xe3o configurados. Defina MASTER_GOOGLE_ACCESS_TOKEN e MASTER_GOOGLE_REFRESH_TOKEN."),null;g=new d.default({oauth:{access_token:a,refresh_token:b}});try{await g.initialize(),this.driveService=g,console.log("‚úÖ Usando conta mestre (OAuth2) para criar a planilha")}catch(a){return console.error("‚ùå Erro ao inicializar conta mestre do Google Drive:",a),null}}if("clone_by_id"===f.templateType){if(!f.templateSpreadsheetId)throw Error("templateSpreadsheetId \xe9 obrigat\xf3rio quando templateType = clone_by_id");let d=await g.copySpreadsheetFromTemplate(f.templateSpreadsheetId,f.title,b);if(await g.shareSpreadsheet(d.id,c,"writer"),f.shareWithEmails&&f.shareWithEmails.length>0)for(let a of f.shareWithEmails)await g.shareSpreadsheet(d.id,a,"writer");let h=await e.zR.userSpreadsheet.create({data:{userId:a,spreadsheetId:d.id,name:d.name,templateType:"clone_by_id",url:d.url,driveEmail:c,isActive:!0,isShared:!0,autoBackup:f.autoBackup||!1,backupFrequency:f.backupFrequency||null}});return{id:h.id,userId:h.userId,spreadsheetId:h.spreadsheetId,name:h.name,templateType:h.templateType,url:h.url,driveEmail:h.driveEmail,isActive:h.isActive,isShared:h.isShared,createdAt:h.createdAt,updatedAt:h.updatedAt}}throw Error("TemplateType n\xe3o suportado. Use clone_by_id.")}catch(a){return console.error("‚ùå Erro ao criar planilha:",a),null}}async getUserSpreadsheets(a){try{return(await e.zR.userSpreadsheet.findMany({where:{userId:a,isActive:!0},orderBy:{createdAt:"desc"}})).map(a=>({id:a.id,userId:a.userId,spreadsheetId:a.spreadsheetId,name:a.name,templateType:a.templateType,url:a.url,driveEmail:a.driveEmail,isActive:a.isActive,isShared:a.isShared,createdAt:a.createdAt,updatedAt:a.updatedAt}))}catch(a){return console.error("‚ùå Erro ao listar planilhas do usu\xe1rio:",a),[]}}async getSpreadsheetDetails(a){try{if(!this.driveService)throw Error("Google Drive Service n\xe3o est\xe1 dispon\xedvel");return await this.driveService.getSpreadsheetInfo(a)}catch(a){return console.error("Erro ao obter detalhes da planilha:",a),null}}async shareSpreadsheet(a,b,c="writer"){try{let d=process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,e=[...b];for(let b of(d&&!e.includes(d)&&(e.push(d),console.log("\uD83D\uDD17 Adicionando email do servi\xe7o Google \xe0 lista de compartilhamento:",d)),console.log(`üîó Compartilhando planilha ${a} com ${e.length} usu\xe1rios`),e)){if(!this.driveService)throw Error("Google Drive Service n\xe3o est\xe1 dispon\xedvel");await this.driveService.shareSpreadsheet(a,b,c)||console.warn(`‚ö†Ô∏è Falha ao compartilhar com ${b}`)}return!0}catch(a){return console.error("‚ùå Erro ao compartilhar planilha:",a),!1}}async createSpreadsheetBackup(a,b,c){try{let b=new Date().toISOString().split("T")[0],d=c||`Backup_${b}_${a.substring(0,8)}`;if(!this.driveService)throw Error("Google Drive Service n\xe3o est\xe1 dispon\xedvel");let e=await this.driveService.createBackup(a,d);return e&&console.log("‚úÖ Backup criado com sucesso:",e),e}catch(a){return console.error("‚ùå Erro ao criar backup:",a),null}}async setupAutoBackup(a,b){try{return console.log(`‚è∞ Backup autom\xe1tico configurado para ${a}: ${b}`),!0}catch(a){return console.error("‚ùå Erro ao configurar backup autom\xe1tico:",a),!1}}async deactivateSpreadsheet(a,b){try{return console.log(`üóëÔ∏è Planilha ${a} desativada para usu\xe1rio ${b}`),!0}catch(a){return console.error("‚ùå Erro ao desativar planilha:",a),!1}}async getUserSpreadsheetStats(a){try{let b=await this.getUserSpreadsheets(a),c={total:b.length,active:b.filter(a=>a.isActive).length,byTemplate:{},oldestCreated:null,newestCreated:null,totalShared:0};return b.forEach(a=>{c.byTemplate[a.templateType]=(c.byTemplate[a.templateType]||0)+1,(!c.oldestCreated||a.createdAt<c.oldestCreated)&&(c.oldestCreated=a.createdAt),(!c.newestCreated||a.createdAt>c.newestCreated)&&(c.newestCreated=a.createdAt),a.sharedWith&&a.sharedWith.length>0&&(c.totalShared+=a.sharedWith.length)}),c}catch(a){return console.error("‚ùå Erro ao obter estat\xedsticas:",a),null}}async testConnection(){try{if(!this.driveService)return!1;return await this.driveService.testConnection()}catch(a){return console.error("Erro ao testar conex\xe3o:",a),!1}}async createDefaultSpreadsheetForUser(a,b,c){try{console.log("\uD83D\uDCCA Criando planilha padr\xe3o para usu\xe1rio:",a);let d=await e.zR.userSpreadsheet.findMany({where:{userId:a,isActive:!0}});if(d.length>0)return console.log("‚úÖ Usu\xe1rio j\xe1 possui planilha ativa"),d[0];let f={templateType:"clone_by_id",templateSpreadsheetId:"1hTipRbl9CS7ELz_P2h_g_PYi_mqXMpM53i_npLmwRS8",title:`Apostas - ${b}`,autoBackup:!1};return await this.createUserSpreadsheet(a,b,c,f)}catch(a){return console.error("‚ùå Erro ao criar planilha padr\xe3o:",a),null}}async getUserActiveSpreadsheet(a){try{let b=await e.zR.userSpreadsheet.findFirst({where:{userId:a,isActive:!0},orderBy:{createdAt:"desc"}});return b?.spreadsheetId||null}catch(a){return console.error("‚ùå Erro ao buscar planilha ativa:",a),null}}async reapplyResultadoValidationForUser(a){let b=[],c=0;try{if(!this.driveService)throw Error("Google Drive Service n\xe3o est\xe1 dispon\xedvel");for(let d of(await e.zR.userSpreadsheet.findMany({where:{userId:a,isActive:!0},orderBy:{createdAt:"desc"}})))try{await this.driveService.reapplyResultadoValidation(d.spreadsheetId)?c+=1:b.push(`Falha em ${d.spreadsheetId}`)}catch(a){b.push(`Erro em ${d.spreadsheetId}: ${a?.message||a}`)}return{success:0===b.length,updated:c,errors:b}}catch(a){return b.push(a?.message||"Erro inesperado"),{success:!1,updated:c,errors:b}}}}let g=f},96330:a=>{a.exports=require("@prisma/client")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4985,6055,3205,5663,5976,9389,8791],()=>b(b.s=78657));module.exports=c})();